<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>前臺頁面表格</title>
		<meta name="Keywords" content="" />
		<meta name="Description" content="" />
		<link rel="stylesheet" href="css/web.css" />
				<style>
			.h-cent table tr td:first-child{
				width: 50px;
			}
			.top-center table tr td:first-child{
				width: 25px;
			}
			.h-cent table td{
				width: 39px;
			}
			.wid30{
				width: 34%;
			}
			.wid25{
				width: 25%;
			}
			.y-bott table td{
				width: 78px;
			}
			.y-bott table td:first-child{
				width: 50px;
			}
			
			.int_item{
			display: inline;
			}
		</style>
	</head>
	<body>
		<div class="inner-out">
			<!--顶部-->
			<div class="h110">
			<div class="head clear">
				<!--顶部左边-->
				<div class="fl h-left clear">
					<table>
						<tr>
							<td colspan="3">
								<div class="button">
									<a id="btn_bottom" href="#bottom"><button>返回</button></a>
									<button onclick="reNew()">刷新</button>
									<button onclick="logout()">關閉</button>
								</div>
							</td>
						</tr>
						<tr class="rd">
							<td class="last_index">--</td>
							<td colspan="2">提供報告</td>
						</tr>
					</table>
				</div>
				
				<!--顶部中间-->
				<div class="fl top-center h-cent" style="position: absolute;left: 182px;">
					<table>
						<tr>
							<td colspan="12" id="modName">計算表-</td>
						</tr>
						<tr class="input-td" id="input_group">
							<td class="rd one" id="crow_group">--</td>
							<td><input onkeyup="onInput(this)" autofocus="autofocus" class="int_item" type="text" maxlength="1" value="" /></td>
							<td><input onkeyup="onInput(this)" class="int_item" type="text" maxlength="1" value="" /></td>
							<td><input onkeyup="onInput(this)" class="int_item" type="text" maxlength="1" value="" /></td>
							<td><input onkeyup="onInput(this)" class="int_item" type="text" maxlength="1" value="" /></td>
							<td><input onkeyup="onInput(this)" class="int_item" type="text" maxlength="1" value="" /></td>
							<td><input onkeyup="onInput(this)" class="int_item" type="text" maxlength="1" value="" /></td>
							<td><input onkeyup="onInput(this)" class="int_item" type="text" maxlength="1" value="" /></td>
							<td><input onkeyup="onInput(this)" class="int_item" type="text" maxlength="1" value="" /></td>
							<td><input onkeyup="onInput(this)" class="int_item" type="text" maxlength="1" value="" /></td>
							<td><input onkeyup="onInput(this)" class="int_item" type="text" maxlength="1" value="" /></td>
							<td style="width: 25px;" rowspan="2">结果<br>趋势</td>
							 
						</tr>
						<tr>
							<td class="one">序號</td>
							<td>第 <text class="rd">1</text> 戶</td>
							<td>第 <text class="rd">2</text> 戶</td>
							<td>第 <text class="rd">3</text> 戶</td>
							<td>第 <text class="rd">4</text> 戶</td>
							<td>第 <text class="rd">5</text> 戶</td>
							<td>第 <text class="rd">6</text> 戶</td>
							<td>第 <text class="rd">7</text> 戶</td>
							<td>第 <text class="rd">8</text> 戶</td>
							<td>第 <text class="rd">9</text> 戶</td>
							<td>第 <text class="rd">10</text> 戶</td>
						</tr>
					</table>
				</div>
				
				<!--顶部右边-->
				<div class="fr h-right clear">
					<table>
						<tr>
							<td colspan="3">
								<div class="button">
									<button onclick="doInput()">確定</button>
								</div>
							</td>
						</tr>
						<tr class="rd">
							<td class="last_index">--</td>
							<td colspan="2">列隊報告</td>
						</tr>
					</table>
				</div>
			</div>
			</div>
		
			<!--中间部分-->
			<div class="middle clear" >
				<div class="fl h-left">
					<!--左边部分-->
					<table>
					<tr><td colspan="3" style="height: 1px"></td></tr>
						<tbody id="tglist_group">
							<!-- <tr>
								<td>第 <text class="rd">1</text> 户</td>
								<td class="rd">老</td>
							</tr> -->
						</tbody>
					</table>
				</div>
				
				<!--中间-->
				<div class="fl">
					<div class="fl h-cent midd">
					<table>
						<!-- <tr>
							<td class="one">0</td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr>
						<tr>
							<td class="one">0</td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
						</tr> -->
						<tbody id="main_tb">
						
						<!-- <tr>
							<td class="one">4</td>
							<td>少</td>
							<td class="bg">女</td>
							<td>少</td>
							<td class="bg">男</td>
							<td>少</td>
							<td>女</td>
							<td class="bg">少</td>
							<td>男</td>
							<td class="bg">少</td>
							<td>女</td>
							<td class="bg">少</td>
							<td>男</td>
							<td class="bg">少</td>
							<td>女</td>
							<td>少</td>
							<td class="bg">男</td>
							<td>少</td>
							<td class="bg">女</td>
							<td>少</td>
							<td class="bg">男</td>
						</tr> -->
						</tbody>
						<!-- <tr>
							<td class="one" colspan="21"><a id="bottom">-----底部-----</a></td>
							
						</tr> -->
					</table>
				</div>
				
				<div class="y-bott h-cent">
					<table>
						<tbody><tr class="cord">
							<td class="one">序號</td>
							<td colspan="2">第 <text class="rd">1</text> 戶</td>
							<td colspan="2">第 <text class="rd">2</text> 戶</td>
							<td colspan="2">第 <text class="rd">3</text> 戶</td>
							<td colspan="2">第 <text class="rd">4</text> 戶</td>
							<td colspan="2">第 <text class="rd">5</text> 戶</td>
							<td colspan="2">第 <text class="rd">6</text> 戶</td>
							<td colspan="2">第 <text class="rd">7</text> 戶</td>
							<td colspan="2">第 <text class="rd">8</text> 戶</td>
							<td colspan="2">第 <text class="rd">9</text> 戶</td>
							<td colspan="2">第 <text class="rd">10</text> 戶</td>
							<td style="width: 50px;" rowspan="2">序號</td>
						</tr> 
					</tbody></table>
					</div>
				</div>
			
				
				<div class="fr h-left">
					<!--右边部分-->
					<table id="queue_group">
						<!-- <tr>
							<td>第 <text class="rd">1</text> 户</td>
							<td>16</td>
							<td class="rd">老</td>
						</tr> -->
						
					</table>
				</div>
			</div>
			
			<!--底部-->
			<div class="foot clear">
				<div class="fl f-left">
					<table>
						<tr>
							<td class="one">提供統計</td>
							<td class="rd" id="tg_group">--</td>
							<td class="one">提供結果</td>
						</tr>
						<tr style="height: 60px;">
							<td rowspan="2" colspan="3">列隊結果</td>
						</tr>
					</table>
				</div>
			
				<div class="fl f-cent">
					<table>
						<tr class="rd">
							<td colspan="20" id="tgSum_group">--</td>
						</tr>
						<tr>
							<td>6</td>
							<td>7</td>
							<td>8</td>
							<td>9</td>
							<td>10</td>
							<td>11</td>
							<td>12</td>
							<td>13</td>
							<td>14</td>
							<td>15</td>
							<td>16</td>
							<td>17</td>
							<td>18</td>
							<td>19</td>
							<td>20</td>
							<td>21</td>
							<td>22</td>
							<td>23</td>
							<td>24</td>
						
						</tr>
						<tr class="rd" id="query_group1">
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
							
						</tr>
					</table>
				</div>
			
				<div class="fr h-left">
					<table >
						<tr>
							<td style="width: 42px;" colspan="2" class="one"><a title="导出表格" href="javascript:tableExport()">列隊統計</a></td>
							<td colspan="2" class="rd" id="queueCount">--</td>
						</tr>
						
						<tr>
							<td>25</td>
							<td>26</td>
							<td>27</td>
							<td>28</td>
						</tr>
						<tr class="rd" id="query_group2">
							<td>-</td>
							<td>-</td>
							<td>-</td>
							<td>-</td>
						</tr>
					</table>
				</div>
			</div>
		</div> 
	
		<script type="text/javascript" src="js/jquery-1.12.4.min.js" ></script>
		<script src="js/app.js"></script>
		<script src="jslib/layer/layer.js"></script>
		<script type="text/javascript" src="js/template-web.js"></script>
		
		<script type="text/javascript" src="js/tableExport.min.js"></script>
		<script type="text/javascript" src="js/jquery.base64.js"></script>
		
	<script type="text/javascript">
	function onInput(inp){
		var i = $('.int_item').index($(inp));
		inp.value=inp.value.replace(/[^1234.]/g,'')
			if ($(inp).val().length==1) {
				i++;
				$('.int_item').eq(i).focus();
			} else if ($(inp).val().length>1) {
				inp.value=inp.value.replace(/[\d]/g,'')
			}
			if (window.event.keyCode==8) {
				inp.value="";
				if (i<=0) {
					i=0;
				} else{
					i--;
				}
				$('.int_item').eq(i).focus();
			}
			
	}
	
	
	
	function reNew(){
		 layer.confirm('是否重新開始？', {
			    btn: ['確定', '取消']
			  },function(index){
				  layer.close(index);
				  $app.request("user/game/renew.do",function(data){
					  if(data.code!=1){
							$app.alert(data.msg);
							return;
						}
					  cleanInput();
						ref(data.data);
					  
				  });
				  
			  });
	}
	
	
	function doInput(){
		var val = getInput();
		if(!val){
			layer.alert("請輸入完整");
			return;
		}
		$app.request("user/game/input.do?pei="+val,function(data){
			if(data.code!=1){
				$app.alert(data.msg,"e");
				return;
			}
			cleanInput();
			$app.msg("ok");
			ref(data.data);
			
		}); 
		
	}
	
	
	function getInput(){
		
		var inputs = $("#input_group input");
		var val="";
		inputs.each(function(i,e){
			var v = $(e).val();
			if(!(/^[1234]{1}$/g).test(v))return;
			val+=v;
		});
		if(val.length!=10)return;
		
		return val;
	}
	
	function cleanInput(){
		
		var inputs = $("#input_group input");
		inputs.val("");
	}
	
	function logout(){
		layer.confirm('您確定要退出？', {
			  btn: ['確定','取消'] //按钮
			}, function(){
				$app.request("logout.do",function(data){
					window.location.href = $app.loginUrl;
				});
			});
		 
		
	}
	
	function tableExport(){
		var tb = $(etbHtml);
		
		$("body").append(tb);
		tb.tableExport({type:'excel',ignoreColumn: [],ignoreRow:[]
			, separator:';', escape:'false'
				 ,formats: ['xlsx']
		,fileName: '前臺表導出'+new Date().format("yyyy-MM-dd")});
		tb.remove();
	}
	
	
	
	</script>
	<script type="text/javascript">
	
	var notifyDialog;
	
	$(function(){
		 $app.request("user/game/data.do",function(data){
				if(data.code!=1){
					$app.alert(data.msg);
					return;
				}
				
				ref(data.data);
			});
		 
		　$(document).keydown(function(event){
			
			　if(event.keyCode == 32){
				layer.close(notifyDialog);
				　　}
		　　　　
			　
		　　});
		
	});
	
	
var etbHtml = "";	
	
	function ref(data){
		var queue = gameCore.queue(data.count.queue,data.lastRow.gong);
		console.log(queue)
	}
	
	
	
	</script>
	<script type="text/javascript">
	var gameCore = {
			HU_NUM:20
			,ITEM_LENGTH:4
		,queue:function(scan,gong){
			var scans = scan.split(",");
			var gongs = gong.split(",");
			var ret = [];
			for (var i = 0; i < scans.length; i++) {
				for (var j = 0; j < this.HU_NUM; j++) {
					var item = scans[i].substring(j*this.ITEM_LENGTH,j*this.ITEM_LENGTH+4);
					var nv = gongs[i].substring(j,j+1)
					if(new Number(item.substring(1,4))>=11){
						ret.push({hu:j%2!=0?j/2+0.5:j/2+1,
							nv:nv,
							zf:item.substring(0,1),
							num:new Number(item.substring(1,3))})
						
					}
				}
			}
			
			return ret;
			
		}
		
	
			
			
	}
	
	
	
	
	</script>
	<script type="text/html" id="tmpl_etb">
	
	</script>
	
	
	</body>
</html>
