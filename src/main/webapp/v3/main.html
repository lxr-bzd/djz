<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">

	    <meta name="description" content="">
	
	    <meta name="Keywords" content="">
	
	    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<link rel="stylesheet" type="text/css" href="css/main.css"/>
	</head>
	<body>
	<span id="tip_msg" style="display: none;position: fixed;left: 0;top: 0;">刷新中</span>
		<!--前臺表-->
		<section class="reception_wrap">
			<div class="reception_box">
				<!--數據表-->
				<table>
					<tr class="reception">
						<!--A表-->
						<td colspan="12" class="table_top rec-table-one">
							<table border="0" class="">
							  	<!--<caption>計算表</caption>-->
							  	<!--表頭-->
							  	<tr class="tb_head">
							    	<th colspan="12" class="child_tit" style="font-size:60px;">計&nbsp;算&nbsp;表&nbsp;</th>
							  	</tr> 
							  	<tr>
							  		<!--序號-->
							    	<td colspan="12" class="child_stit">報告結果&nbsp;&nbsp;</td>
							  	</tr>
							  	<!--數據行-1-->
							  	<tr class="data_col">
							    	<td>1</td>
							    	<td>2</td>
							    	<td>3</td>
							    	<td>4</td>
							    	<td>5</td>
							    	<td>6</td>
							    	<td>7</td>
							    	<td>8</td>
							    	<td>9</td>
							    	<td>10</td>
							    	<td>11</td>
							    	<td>12</td>
							  	</tr>
							  	<!--數據行-2-->
							  	<tr class="data_col_two">
							    	<td>2</td>
							    	<td>3</td>
							    	<td>3</td>
							    	<td>3</td>
							    	<td>2</td>
							    	<td>1</td>
							    	<td>1</td>
							    	<td>1</td>
							    	<td>1</td>
							    	<td>1</td>
							    	<td>1</td>
							    	<td>1</td>
							  	</tr>
							  	
							</table>
						</td>
						<!--B表-->
						<td colspan="4" class="table_top rec-table-two">
							<table border="" cellspacing="" cellpadding="" class="table-head">
								<!--表頭-->
							  	<tr class="tb_head">
							    	<th colspan="4" class="main_tit">報告</th>
							  	</tr> 
							  	<tr> 
							  		<td colspan="4" class="child_stit_r focus_row" style="color:red;">--</td>
							  	</tr>
							</table>
							<div style="overflow-y:scroll;height:460px">
							<table border="1" >
							  	<!--<caption>計算表  B</caption>-->
							  	
							  	<!--數據行-1-->
							  	<tbody id="queue_group">
							  	<!-- <tr class="data_col_r" >
							  		<td class="frist">第 <span class="red">9</span> 位</td>
							    	<td>女</td>
							    	<td>-</td>
							    	<td>6</td>
							  	</tr> -->
							  	
							  	</tbody>
							  	
							  </table>
							  </div>
							  <table border="1" style="height: 60px;">	
							  		<!--关闭-->
							  	
							  		<tr class="child_stit_r">
								    	<td colspan="1" class="pad-no"><div class="close-btn" onclick="onClose()">關閉</div></td>
								  	<td colspan="1" class="pad-no"><div class="close-btn" onclick="window.location.reload()">刷新</div></td>
								  	
								  	</tr>
								  	
							</table>
						</td>
					</tr>
					
				</table>
				<!--彈窗-->
				<!--關閉按鈕-->
				<div class="exit_pup_wrap hide">
					<div class="exit_pup_box">
						<div class="exit_pup">
							<h2>確定要關閉嗎？</h2>
							<div class="pup_btn">
								<a href="javascript:;" class="cancel_btn">取消</a>
								<a href="../login.html">確定</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		
		<script src="js/jquery-1.11.2.min.js"></script>
		<script type="text/javascript">
			//關閉彈窗
			function onClose(){
				$(".exit_pup_wrap").addClass("showtb").removeClass("hide")
				
			}
			$(".cancel_btn").click(function () {
				$(".exit_pup_wrap").addClass("hide").removeClass("showtb")
			})
		</script>
	</body>
	
		<script src="../js/app.js"></script>
		<script src="../jslib/layer/layer.js"></script>
		<script type="text/javascript" src="../js/template-web.js"></script>
		
		<script type="text/javascript" src="../js/tableExport.min.js"></script>
		<script type="text/javascript" src="../js/jquery.base64.js"></script>
		
	<script type="text/javascript">
//	input輸入框
	$('.int_item').on('input propertychange',onInput);
	function onInput(e){
		var inp = e.currentTarget;
		var i = $('.int_item').index($(inp));
		inp.value=inp.value.replace(/[^1234.]/g,'')
			if ($(inp).val().length==1) {
				i++;
				$('.int_item').eq(i).focus();
			} else if ($(inp).val().length>1) {
				inp.value=inp.value.replace(/[\d]/g,'')
			}
			if (window.event.keyCode==8) {
				inp.value="";
				if (i<=0) {
					i=0;
				} else{
					i--;
				}
				$('.int_item').eq(i).focus();
			}
			
	}
	
	
	
	function reNew(){
		 layer.confirm('是否重新開始？', {
			    btn: ['確定', '取消']
			  },function(index){
				  layer.close(index);
				  $app.request("../user/game/renew.do",function(data){
					  if(data.code!=1){
							$app.alert(data.msg);
							return;
						}
					  cleanInput();
						ref(data.data);
					  
				  });
				  
			  });
	}
	
	
	function doInput(){
		var val = getInput();
		if(!val){
			layer.alert("請輸入完整");
			return;
		}
		$app.request("../user/game/input.do?pei="+val,function(data){
			if(data.code!=1){
				$app.alert(data.msg,"e");
				return;
			}
			cleanInput();
			$app.msg("ok");
			ref(data.data);
			
		}); 
		
	}
	
	
	function getInput(){
		
		var inputs = $("#input_group input");
		var val="";
		inputs.each(function(i,e){
			var v = $(e).val();
			if(!(/^[1234]{1}$/g).test(v))return;
			val+=v;
		});
		if(val.length!=10)return;
		
		return val;
	}
	
	function cleanInput(){
		
		var inputs = $("#input_group input");
		inputs.val("");
	}
	
	function logout(){
		layer.confirm('您確定要退出？', {
			  btn: ['確定','取消'] //按鈕
			}, function(){
				$app.request("../logout.do",function(data){
					window.location.href = $app.loginUrl;
				});
			});
		 
		
	}
	
	function tableExport(){
		var tb = $(etbHtml);
		
		$("body").append(tb);
		tb.tableExport({type:'excel',ignoreColumn: [],ignoreRow:[]
			, separator:';', escape:'false'
				 ,formats: ['xlsx']
		,fileName: '前臺表導出'+new Date().format("yyyy-MM-dd")});
		tb.remove();
	}
	
	
	
	</script>
	<script type="text/javascript">
	
	var notifyDialog;
	
	$(function(){
		onRef();
		 setInterval("onRef()",5000);
		
		
	});
	
	function onRef(){
		$("#tip_msg").show();
		 $app.request("../user/game/data.do",function(data){
			 $("#tip_msg").hide();
				if(data.code!=1){
					$app.alert(data.msg);
					return;
				}
				
				ref(data.data);
			});
		
	}
	
	
var etbHtml = "";	
	
	function ref(data){
		$(".focus_row").html(data.game.focus_row-2);
		if(data.game.focus_row>=3){
			var queue = gameCore.queue(data.count.queue,data.lastRow.gong);
			var html = "";
			for (var i = 0; i < queue.length; i++) {
				html+='<tr class="data_col_r"><td class="frist">第 <span class="red"> '+queue[i].hu+' </span>戶</td>'
		    	+'<td>'+queue[i].nv+'</td><td>'+queue[i].zf+'</td><td>'+queue[i].num+'</td></tr>'
			}
			if(!html)
				$("#queue_group").html('<tr style="height:460px;"></tr>');
			else
				$("#queue_group").html(html+"<tr></tr>");
			
		}
		
		
		
		var html2 = '';
		var qs = data.count.queue_count.split(",");
		for (var i = 0; i < 12; i++) {
			html2+='<td>'+(qs[i+5]?qs[i+5]:0)+'</td>'; 
		}
		
		
		$(".data_col_two").html(html2)
		
	}
	
	
	
	</script>
<script type="text/javascript">
	var gameCore = {
			HU_NUM:20
			,ITEM_LENGTH:4
		,queue:function(scan,gong){
			var scans = scan.split(",");
			var gongs = gong.split(",");
			
			var tempRet = [];
			for (var i = 0; i < scans.length; i++) {
				for (var j = 0; j < this.HU_NUM; j++) {
					var item = scans[i].substring(j*this.ITEM_LENGTH,j*this.ITEM_LENGTH+4);
					var nv = gongs[i].substring(j,j+1)
					var num = new Number(item.substring(1,4));
					if(num>=11){
						var h = j%2!=0?j/2+0.5:j/2+1;
						if(!tempRet[h])tempRet[h] = [];
						tempRet[h].push({hu:h,
							nv:nv,
							zf:item.substring(0,1),
							num:num-10})
						
					}
				}
			}
			
			var ret = [];
			for (var i = 0; i < tempRet.length; i++) {
				if(tempRet[i])
				ret = ret.concat(tempRet[i]);
			}
			
			return ret;
			
		}
		
	
			
			
	}
	</script>
</html>