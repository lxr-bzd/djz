<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">

	    <meta name="description" content="">
	
	    <meta name="Keywords" content="">
	
	    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<link rel="stylesheet" type="text/css" href="css/main.css"/>
		<style type="text/css">
			table{border-collapse: collapse;}
			table td,table th{
				border: 1px solid rgba(0,0,0,1);
			}
			.top-body{overflow-y: scroll;}
			.top-body>table{table-layout: fixed;}
			.scroll-body{overflow-y: scroll;height: 420px;}
			.scroll-body>table{table-layout: fixed;}
			.scroll-body td{height: 35px;}
			.bottom-body{overflow-y: scroll;}
			.bottom-body>table{table-layout: fixed;}
			.bottom-body td{height: 35px;}
			
			.blue{background-color: #087ec3;color: white;}
			.blue2{background-color: #92ebff;}
			.locak_btn1{background-color: #dddddd;padding: 3px 3px;cursor: pointer;border-radius:5px}
			.locak_btn2{background-color: yellow;padding: 3px 3px;cursor: pointer;border-radius:5px}
			
			.click_span{padding: 3px 8px;cursor: pointer;border-radius:5px}
			
			.btn1{cursor: pointer;text-align: center;margin: 5px;height: 40px;line-height: 40px;border-radius:5px}
			
			.bg-td{text-align: left; display: flex;}
			.bg-td>span{flex:1;text-align: center;}


.test-panel { 
position:absolute; /*绝对定位*/ 
top:20px; /*距顶部50%*/ 
left:0px; 
padding:18px 15px;
/* margin:-100px 0 0 -150px; */ /*设定这个div的margin-top的负值为自身的高度的一半,margin-left的值也是自身的宽度的一半的负值.(感觉在绕口令)*/ 
width:160px; /*宽为400,那么margin-top为-200px*/ 
height:85px; /*高为200那么margin-left为-100px;*/ 
z-index:999999999; /*浮动在最上层 */ 
/* filter:alpha(Opacity=80);-moz-opacity:0.8;opacity: 0.8; */
background-color:#191970;
} 

.test-btn{
font-weight:bold;
font-size:16px;
filter:alpha(Opacity=100);-moz-opacity:1;opacity:1;
}
		
		</style>
	</head>
	<body>
		<!--前臺表-->
		<section class="reception_wrap" style="overflow-x: scroll;height: 100%;">
			<div class="reception_box">
				<!--數據表-->
				<table>
					<tr class="reception">
						<!--A表-->
						<td  class="table_top rec-table-one">
						<div class="top-body">
							<table border="0" style="border: 1px solid #000;width:100%">
							<colgroup>
								<col style="width:60px;">
								
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								
								
								<col style="width:140px;">
								<col style="width:140px;">
								<col style="width:140px;">
								
								<col style="width:60px;">
								
							</colgroup>
							  	<tbody id="bg_group">
							  	<tr class="data_col person_int">
							    	<td rowspan="4" class="focus_row">--</td>
							    	<td colspan="6" class="blue" style="font-size:24px">計 算 表</td>
							    	<!-- <td colspan="3" class="blue mod_group">--</td> -->
							    	<td ><div class="blue btn1 refresh_btn">刷新</div></td>
							    	<td ><a href="su_history.html" ><div class="blue btn1">記錄</div></a></td>
							    	<td ><div class="blue btn1 remove-all">清空</div></td>
							    	<td ><div class="blue btn1 exit_btn">關閉</div></td>
							    	
							    	<td colspan="2" id="input_group"><input type="text" style="width: 90%;background-color: #eee" maxlength="1" autofocus="autofocus" class="int_item" placeholder=""></td>
							    	<td colspan="1"> <div class="blue btn1 ok_btn">確定</div></td>
							    	<td rowspan="4" class="focus_row">--</td>
							    	
							  	</tr>
							  	
							  	<tr class="data_col">
							    	
							    	<td>1
<span class="locak_btn1" >瑣</span>
												</td>
				
							    	<td>2
<span class="locak_btn1" >瑣</span>
												</td>
				
							    	<td>3 
<span class="locak_btn1" >瑣</span>
												</td>
				
							    	<td>4
<span class="locak_btn1" >瑣</span>
												</td>
				
							    	<td>5
<span class="locak_btn1" >瑣</span>
												</td>
				
							    	<td>6
<span class="locak_btn1" >瑣</span>
												</td>
				
							    	<td>7
<span class="locak_btn1" >瑣</span>
												</td>
				
							    	<td>8
<span class="locak_btn1" >瑣</span>
												</td>
				
							    	<td>9
<span class="locak_btn1" >瑣</span>
												</td>
				
							    	<td>10
<span class="locak_btn1" >瑣</span>
												</td>
							    	<td>匯總報告</td>
							    	<td>合并報告</td>
									<td>選擇報告</td>
							    	
							  	</tr>
							  	<tr class="data_col ">
							    	<td>&nbsp;<span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	<td> <span class="red"></span></td>
							    	
							  	</tr>
							  <tr class="data_col ">
							    	<td style="text-align: left;">&nbsp;<span class="red"  style="display: inline-block;float: right;"></span></td>
							    	<td><span class="red"></span></td>
							    	<td><span class="red"></span></td>
							    	<td><span class="red"></span></td>
							    	<td><span class="red"></span></td>
							    	<td><span class="red"></span></td>
							    	<td><span class="red"></span></td>
							    	<td><span class="red"></span></td>
							    	<td><span class="red"></span></td>
							    	<td><span class="red"></span></td>
							    	<td><span class="red"></span></td>
							    	<td><span class="red"></span></td>
							    	
							  	</tr>
							  	<tr class="data_col ">
							  		<td>序號</td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td>序號</td>
							  	</tr>
							  	</tbody>
							</table>
							</div>
						</td>
						
					</tr>
					<tr>
						<td>
							<div class="scroll-body">
							<table class="rec-table-one" style="height:auto;width:100%;">
								<colgroup>
								<col style="width:60px;">
								
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								
								
								<col style="width:140px;">
								<col style="width:140px;">
								<col style="width:140px;">
								
								<col style="width:60px;">
								
							</colgroup>
								<tbody id="jg_group">
								
							  	<!-- <tr >
							  		<td>1</td>
							    	<td>200</td>
							    	<td>200</td>
							    	<td>200</td>
							    	<td>200</td>
							    	<td>200</td>
							    	<td>200</td>
							    	<td>200</td>
							    	<td>200</td>
							    	<td>200</td>
							    	<td>200</td>
							    	<td>1</td>
							    	<td>200</td>
							    	<td>200</td>
							    	<td>1</td>
							  	</tr> -->
							  	</tbody>
							</table>
							</div>
						
						</td>
					</tr>
					<tr>
						<td>
							<div class="bottom-body">
							<table class="table_top" style="width:100%">
								<colgroup>
								<col style="width:60px;">
								
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								<col style="width:110px;">
								
								
								<col style="width:140px;">
								<col style="width:140px;">
								<col style="width:140px;">
								
								<col style="width:60px;">
								
							</colgroup>
								<tbody id="bottom_group">
								<tr >
							  		<td>結果</td>
							    	<td class="blue2"></td>
							    	<td class="blue2"></td>
							    	<td class="blue2"></td>
							    	<td class="blue2"></td>
							    	<td class="blue2"></td>
							    	<td class="blue2"></td>
							    	<td class="blue2"></td>
							    	<td class="blue2"></td>
							    	<td class="blue2"></td>
							    	<td class="blue2"></td>
							    	
							    	<td class="blue2"></td>
							    	<td class="blue2"></td>
							    	<td>結果</td>
							  	</tr>
							  	<tr >
							  		<td>求和</td>
							    	<td></td>
							    	<td></td>
							    	<td></td>
							    	<td></td>
							    	<td></td>
							    	<td></td>
							    	<td></td>
							    	<td></td>
							    	<td></td>
							    	<td></td>
							    	
							    	<td></td>
							    	<td></td>
							    	<td>求和</td>
							  	</tr>
							  	<tr >
							  		<td>共計</td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	
							    	<td class="blue"></td>
							    	<td class="blue"></td>
							    	<td>共計</td>
							  	</tr>
							  	</tbody>
							</table>
							</div>
						
						</td>
					</tr>
				</table>
				<!--彈窗-->
				<!--關閉按鈕-->
				<div class="exit_pup_wrap hide">
					<div class="exit_pup_box">
						<div class="exit_pup">
							<h2>確定要關閉嗎？</h2>
							<div class="pup_btn">
								<a href="javascript:;" class="cancel_btn">取消</a>
								<a href="reception-login.html">確定</a>
							</div>
						</div>
					</div>
				</div>
				<!--刷新按鈕-->
				<div class="refresh_pup_wrap hide">
					<div class="exit_pup_box">
						<div class="exit_pup">
							<h2>確定要刷新嗎？</h2>
							<div class="pup_btn">
								<a href="javascript:;" class="cancel_btn">取消</a>
								<a href="javascript:;" class="pup_sure_btn">確定</a>
							</div>
						</div>
					</div>
				</div>
				<!--確定按鈕-->
				<div class="sure_pup_wrap hide">
					<div class="exit_pup_box">
						<div class="exit_pup">
							<h2>請檢查輸入框是否填滿</h2>
							<div class="pup_btn">
								<a href="javascript:;" class="pup_sure">確定</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<div class="test-panel"></div>
		
		<script src="js/jquery-1.11.2.min.js"></script>
		<script type="text/javascript">
			//關閉彈窗
			$(".exit_btn").click(function () {
				logout();
				//$(".exit_pup_wrap").addClass("showtb").removeClass("hide")
			})
			$(".cancel_btn").click(function () {
				$(".exit_pup_wrap").addClass("hide").removeClass("showtb")
			})
			//刷新彈窗
			$(".refresh_btn").click(function () {
				reNew();
				
			})
			//刷新彈窗
			$(".remove-all").click(function () {
				removeAll();
				
			});
			$(".cancel_btn,.pup_sure_btn").click(function () {
				$(".refresh_pup_wrap").addClass("hide").removeClass("showtb")
			})

//			回刪
			$('.int_item').on('keyup',function(e){
				var i = $('.int_item').index(e.target);
				if (window.event.keyCode==8) {
					this.value="";
					if (i<=0) {
						i=0;
					} else{
						i--;
					}
					$('.int_item').eq(i).focus();
				}
			})	
//			確定按鈕判斷
			var off=null;
			$(".ok_btn").click(function () {
				for (var j=0;j<$('.int_item').length;j++) {
					if ($('.int_item').eq(j).val()=="") {
						off=true;
						break;
					}else{
						off=false;
					}
				}
				
				if (off) {
					$(".sure_pup_wrap").addClass("showtb").removeClass("hide")
					$(".pup_sure").click(function () {
						$(".sure_pup_wrap").addClass("hide").removeClass("showtb")
					})
				}else{
					doInput();
					
				}
			})
		</script>
		
		<script src="../js/app.js"></script>
		<script src="../jslib/layer/layer.js"></script>
		<script type="text/javascript" src="../js/template-web.js"></script>
		
		<script type="text/javascript" src="../js/tableExport.min.js"></script>
		<script type="text/javascript" src="../js/jquery.base64.js"></script>
		
	<script type="text/javascript">
//	input輸入框
	$('.int_item').on('input propertychange',onInput);
	function onInput(e){
		var inp = e.currentTarget;
		var i = $('.int_item').index($(inp));
		inp.value=inp.value.replace(/[^1234.]/g,'')
			if ($(inp).val().length==1) {
				i++;
				$('.int_item').eq(i).focus();
			} else if ($(inp).val().length>1) {
				inp.value=inp.value.replace(/[\d]/g,'')
			}
			if (window.event.keyCode==8) {
				inp.value="";
				if (i<=0) {
					i=0;
				} else{
					i--;
				}
				$('.int_item').eq(i).focus();
			}
			
	}
	
	
	
	function reNew(){
		
		 layer.confirm('是否重新開始？', {
			    btn: ['確定', '取消']
			  },function(index){
				  layer.close(index);
				  var index2 = layer.load(1, {
					  shade: [0.5,'#555'] //0.1透明度的白色背景
					});
				  $app.request("../user/game/renew.do",function(data){
					  layer.close(index2);
					  if(data.code!=1){
							$app.alert(data.msg);
							return;
						}
					  cleanInput();
						ref(data.data);
					  
				  });
				  
			  });
	}
	
	
	function doInput(){
		var val = getInput();
		if(!val){
			layer.alert("請輸入完整");
			return;
		}
		var index = layer.load(1, {
			  shade: [0.5,'#555'] //0.1透明度的白色背景
			});
		$app.request("../user/game/input.do?pei="+val,function(data){
			layer.close(index);
			if(data.code!=1){
					layer.alert(data.msg,{
						  success:function(layero){
									layero.find('.layui-layer-content').css('font-size', '18px');
									}
						});    
				
				return;
			}
			
			var gameRowNum = eval("("+data.data.turn.config_json+")").gameRowNum;
			if(gameRowNum-data.data.turn.frow<=2)myTest.stop();
			
			cleanInput();
			$app.msg("ok");
			ref(data.data);
			onBusEnd();
		}); 
		
	}
	
	
	function getInput(){
		
		var inputs = $("#input_group input");
		var val="";
		inputs.each(function(i,e){
			var v = $(e).val();
			if(!(/^[1234]{1}$/g).test(v))return;
			val+=v;
		});
		if(val.length!=1)return;
		var ret = '';
		for (var i = 0; i < 10; i++) {
			ret+=val;
		}
		return ret;
	}
	
	function cleanInput(){
		
		var inputs = $("#input_group input");
		inputs.val("");
	}
	
	function logout(){
		layer.confirm('您確定要退出？', {
			  btn: ['確定','取消'] //按鈕
			}, function(){
				$app.request("../logout.do",function(data){
					window.location.href = $app.loginUrl;
				});
			});
		 
		
	}
	
	function tableExport(){
		var tb = $(etbHtml);
		
		$("body").append(tb);
		tb.tableExport({type:'excel',ignoreColumn: [],ignoreRow:[]
			, separator:';', escape:'false'
				 ,formats: ['xlsx']
		,fileName: '前臺表導出'+new Date().format("yyyy-MM-dd")});
		tb.remove();
	}
	
	
	
	</script>
	<script type="text/javascript">
	// L  X  D  S
	// 老 少 男 女
	var conf1 = {'L':'L','X':'X','D':'D','S':'S'}
	
	var myTest = {
			val:'',
			open:false,
			start:function(){
				if(!$('#input_group>input').val()){
					layer.msg('未輸入數字，啟動失敗');
					return;
				}
				
				$('.ok_btn').click();
				this.val = $('#input_group>input').val();
				this.open = true;
				$(".test-panel").html('<div class=" btn1 test-btn" style="background-color:#7FFF00;" onclick="myTest.stop()">停止</div>');
				
				
			},
			input:function(){
				$('#input_group>input').val(this.val);
				$('.ok_btn').click();
				
				
			}
			,stop:function(){
				this.val = '';
				this.open = false;
				$(".test-panel").html('<div class=" btn1 test-btn" style="background-color:yellow;" onclick="myTest.start()">啟動</div>');
			},
			init:function(){
				this.stop();
				
				
			}
			};
	
	myTest.init();
	
function onBusEnd(){
	if(myTest.open)	myTest.input();
		
	}
	
	
	var notifyDialog;
	
	$(function(){
		var index = layer.load(1, {
			  shade: [0.5,'#555'] //0.1透明度的白色背景
			});
		 $app.request("../user/game/data.do",function(data){
				layer.close(index);
				if(data.code!=1){
					$app.alert(data.msg);
					return;
				}
				
				
				
				ref(data.data);
			});
		 
		　$(document).keydown(function(event){
			
			　if(event.keyCode == 32){
				layer.close(notifyDialog);
				　　}
		　　　　
			　
		　　});
		
	});
	
	function openTip(){
		layer.open({
			title:'提示',
			  type: 1,
			  skin: 'layui-layer-molv', //样式类名
			  closeBtn: 0, //不显示关闭按钮
			  anim: 2,
			  content: '<div style="padding:20px;width:180px;"></div>'
			,btn:['關閉']
			,success:function(layero){
			  layero.find('.layui-layer-btn').css('text-align', 'center').find('a').css('padding','6px 80px').css('height','40px')
			}
			}); 
		
	}
	
	
var etbHtml = "";
	
	function initViewData(data){
		var mod = data.turn.mod;
		var turn = initTurn(data.turn);
		var counts = data.counts;
		var bgData = {hb:mod==1?bgA(turn.info):bgB(turn.info)}; bgData['hb'].push(turn.lj);
		var jgData = {hb:{list:[],jg:0,qh:0}};
		for (var i = 0; i < counts.length; i++) {
			var count = counts[i];
			count.g = eval(count.g);
			bgData[count.uid] = mod==1?bgA(count.g):bgB(count.g);
			bgData[count.uid].push(count.g_sum);
			jgData[count.uid] = {list:[],jg:count.tg_sum,qh:0};
			var ts = count.tg?count.tg.split(","):[];
			for (var j = 0; j < ts.length; j++) {
				if(!ts[j])continue;
				var jg = jgData[count.uid];
				var v = new Number(ts[j].split("_")[0])+new Number(ts[j].split("_")[1]);
				jg.list[j] = v;
				jg.qh+=(v>0?1:(v<0?-1:0));
				if(turn.user_lock[count.uid-1]=='1'){
					if(isNaN(jgData['hb'].list[j]))jgData['hb'].list[j] = 0;
					jgData['hb'].list[j]+=v;
					
				}
				
			}
		}
		
		for (var i = 0; i < jgData['hb'].list.length; i++) {
			var v = jgData['hb'].list[i];
			jgData['hb'].jg+=v;
			jgData['hb'].qh+=(v>0?1:(v<0?-1:0));
			
		}
		//處理求和結果
		
		turn.qh = eval(turn.qh );
		var qhBg = createBg([turn.qh[1][0],turn.qh[1][1]]);qhBg.push(turn.qh_sum);
		bgData['qhBg'] =qhBg;
		var qhJg = {list:[null],jg:0,qh:0};
		jgData['qhBg'] =qhJg;
		
		var qhjgs = turn.qh_jg?turn.qh_jg.split(","):[];
		for (var i = 0; i < qhjgs.length; i++) {
			if(!qhjgs[i])continue;
			var v = new Number(qhjgs[i]);
			qhJg.list.push(v);
			qhJg.jg+=v;
			qhJg.qh+=(v>0?1:(v<0?-1:0));
		}
		/* 开始处理原值数据 */
		
		turn.yz = eval(turn.yz );
		var yzBg = createBg([turn.yz[1][0],turn.yz[1][1]]);
		yzBg.push(turn.yz_sum);
		bgData['yzBg'] =yzBg;
		var yzJg = {list:[null],jg: turn.yz_jg_sum,qh:0}
		jgData['yzBg'] =yzJg;
		var yzjgs = turn.yz_jg?turn.yz_jg.split(","):[];
		for (var i = 0; i < yzjgs.length; i++) {
			if(!yzjgs[i])continue;
			var v = new Number(yzjgs[i]);
			yzJg.list.push(v);
			yzJg.qh+=(v>0?1:(v<0?-1:0));
		}
		
		/* 结束处理原值数据 */
		
		
		/* 开始处理合并报告  */
		turn.hb = eval(turn.hb );
		var hbBgData = createBg(turn.hb);
		hbBgData.push(turn.hb_sum);
		bgData["hbBg"] = hbBgData;
		
		
		jgData['hbBg'] = {list:[null],jg:turn.hb_jg_sum,qh:0};
		var hbjgs = turn.hb_jg?turn.hb_jg.split(","):[];
		for (var i = 0; i < hbjgs.length; i++) {
			if(!hbjgs[i])continue;
			var v = new Number(hbjgs[i]);
			jgData['hbBg'].list.push(v);
			jgData['hbBg'].qh+=(v>0?1:(v<0?-1:0));
		}
		
		
		/* 结束处理合并报告  */
		/* 开始处理合并求和  */
		turn.hbqh = eval(turn.hbqh );
		var hbqhBgData = createBg(turn.hbqh);
		hbqhBgData.push(turn.hbqh_sum);
		bgData["hbqh"] = hbqhBgData;
		
		
		jgData['hbqh'] = {list:[null],jg:0,qh:0};
		var hbqhjgs = turn.hbqh_jg?turn.hbqh_jg.split(","):[];
		for (var i = 0; i < hbqhjgs.length; i++) {
			if(!hbqhjgs[i])continue;
			var v = new Number(hbqhjgs[i]);
			jgData['hbqh'].list.push(v);
			jgData['hbqh'].qh+=(v>0?1:(v<0?-1:0));
			jgData['hbqh'].jg+=v;
		}
		
		
		/* 结束处理合并合并求和  */
		
		/* 开始处理選擇報告  */
		turn.xz = eval(turn.xz );
		var xzBgData = createBg(turn.xz);
		xzBgData.push(turn.xz_sum);
		bgData["xzBg"] = xzBgData;
		
		
		jgData['xzBg'] = {list:[null],jg:turn.xz_jg_sum,qh:0};
		var xzjgs = turn.xz_jg?turn.xz_jg.split(","):[];
		for (var i = 0; i < xzjgs.length; i++) {
			if(!xzjgs[i])continue;
			var v = new Number(xzjgs[i]);
			jgData['xzBg'].list.push(v);
			jgData['xzBg'].qh+=(v>0?1:(v<0?-1:0));
		}
		
		
		/* 结束处理選擇報告  */
		
		
		
		return {turn:turn,bgData:bgData,jgData:jgData};
		
		function bgA(g){
			var ret = [{name:'',val:''},{name:'',val:''},0];
			ret[0].name = g[4]>0?conf1.L:(g[4]<0?conf1.X:'');
			ret[0].val = ret[0].name?Math.abs(g[4]):0;
			ret[1].name = g[5]>0?conf1.D:(g[5]<0?conf1.S:'');
			ret[1].val = ret[1].name?Math.abs(g[5]):0;
			ret[2] = ret[0].val+ret[1].val
			return ret;
			
		}
		function bgB(g){
			
			
		}
		
		function createBg(arr){
			var ret = [{name:'',val:''},{name:'',val:''},0];
			ret[0].name = arr[0]>0?conf1.L:(arr[0]<0?conf1.X:'');
			ret[0].val = ret[0].name?Math.abs(arr[0]):0;
			ret[1].name = arr[1]>0?conf1.D:(arr[1]<0?conf1.S:'');
			ret[1].val = ret[1].name?Math.abs(arr[1]):0;
			ret[2] = ret[0].val+ret[1].val
			return ret;
			
		}
		
		
	}
	
	function initTurn(oldTurn){
		var turn = oldTurn;
		turn.info = eval(turn.info);
		turn.user_lock = turn.user_lock.split(',');
		turn.xzbg_lock = turn.xzbg_lock.split(',');
		turn.hbbg_lock = turn.hbbg_lock.split(',');
		turn.xzbg_config = turn.xzbg_config.split(',');
		turn.hbbg_config = turn.hbbg_config.split(',');
		return turn;
	}
	
	
	

function ref(data){
	
	if(data.tip_open==1&&data.turn.queue_count>0){
		openTip();
		myTest.stop();
	}
		
	
	
	var frow = data.turn.frow;
	$(".focus_row").html(frow-2);
	$(".mod_group").html(data.turn.mod==1?'A':'B');
	
	$("#jg_group").empty();
	$("#allQh").empty();
	
	var vData = null;
	if(frow>=4)
		var vData = initViewData(data);
	else
	vData = {"turn":initTurn(data.turn)
	,"bgData":{ "hb":[{"name":'',"val":0},{"name":"","val":0},'','']
				,"hbBg":[{"name":'',"val":0},{"name":"","val":0},'','']
				,"yzBg":[{"name":'',"val":0},{"name":"","val":0},'','']
				,"qhBg":[{"name":'',"val":0},{"name":"","val":0},'','']
				,"hbqh":[{"name":'',"val":0},{"name":"","val":0},'','']
	,"xzBg":[{"name":'',"val":0},{"name":"","val":0},'','']}
	,"jgData":{ "hb":{"list":[],"jg":0,"qh":0}
				,"hbBg":{"list":[],"jg":0,"qh":0}
				,"yzBg":{"list":[],"jg":0,"qh":0}
				,"qhBg":{"list":[],"jg":0,"qh":0}
				,"hbqh":{"list":[],"jg":0,"qh":0}
				,"xzBg":{"list":[],"jg":0,"qh":0}
				}
	
	}
	
	
		 
	console.log(vData);
		$("#bg_group>tr:gt(0)").remove();
		$("#bg_group").append(template("bg_tmpl",vData))
		$("#jg_group").html(template("jg_tmpl",vData));
		$("#jg_group>tr:last").attr("id","bottom");
		//
		$("#bottom_group").html(template("bottom_tmpl",vData));
		
	
	
		location.href="#bottom";
	}
	
	/**
	mod:1 汇总报告，2：合并报告，3 選擇報告
	*/
	function setLock(mod,tid,uid,val,btn){
		
		
		$.ajax({
			url:"../user/game/setLock.do",
			data:{mod:mod,uid:uid,tid:tid,val:val},
			type:"post",
			async:false,
			success:function(json){
				if(json.code==1){
					layer.msg('操作成功');
					$(btn).replaceWith(getLockBtnHtml(mod,tid,uid,val));
					
				}else{
					
					alert(json.msg)
				}
			}
		});
		
		
		
		
	}
	
	function getLockBtnHtml(mod,tid,uid,val){
		
		return html  = '<span class="'+(val==1?'locak_btn1':'locak_btn2')+'" onclick="'
		+'setLock('+mod+','+tid+','+uid+','+(val==1?0:1)+',this)" >'+(val==1?'瑣':'解')+'</span>';
		
	}
	

	
	
	function toSetConfig(mod,tid,uid,val,btn){
		
		val = $(btn).html();
		var datas = val.split('-');
		//在这里面输入任何合法的js语句
		layer.open({
		  type: 1,
		  skin: 'layui-layer-demo', //样式类名
		  closeBtn: 0, //不显示关闭按钮
		  anim: 2,
		  shadeClose: true, //开启遮罩关闭
		  content: '<div class="context-div" style="margin:10px;"><input style="width:150px;height:30px;" name="start" type="number"/>-<input style="width:150px;height:30px;" name="end" class="int_item" type="number"/></dev>',
		  btn:['保存','取消'],
		yes: function(index, layero){
			sval = layero.find(".context-div input[name=start]").val()+"-"+layero.find(".context-div input[name=end]").val();
			$.ajax({
				url:"../user/game/setConfig.do",
				data:{mod:mod,uid:uid,tid:tid,val:sval},
				type:"post",
				async:false,
				success:function(json){
					layer.close(index); //如果设定了yes回调，需进行手工关闭
					if(json.code==1){
						layer.msg('保存成功');
						$(btn).html(sval);
						
						
					}else{
						
						alert(json.msg)
					}
				}
			});
		    
		  },
		 success: function(layero, index){
			 layero.find(".context-div input[name=start]").val(datas[0]);
			 layero.find(".context-div input[name=end]").val(datas[1]);
		    console.log(layero, index);
		  }

		}); 
		
	}
	
	 
	
	/**
	清空所有遊戲數據
	*/
	function removeAll(){
		layer.confirm('確定清空數據？', {
			  btn: ['是','否'] 
			}, function(){
				$.ajax({
					url:"../user/game/removeAll.do",
					type:"post",
					async:false,
					success:function(result){
						if(result.code==1){
							layer.msg('成功');
							location.reload();
						}
						else{
							
							alert(result.msg)
						}
					}
				});
			  
			}, function(){
			 
			});
		
	}
		
	
	</script>
	
	
	
	<script type="text/html" id="bg_tmpl">
	<tr class="data_col">
				{{each turn.user_lock as val i}}
							    	<td>{{i+1}} 
{{if val=='1'}}
<span class="locak_btn1" onclick="setLock(1,{{turn.id}},{{i+1}},0,this)" >瑣</span>
												{{else}}
<span class="locak_btn2" onclick="setLock(1,{{turn.id}},{{i+1}},1,this)" >解</span>
												{{/if}}
{{if turn.hbbg_lock[i]=='1'}}
<span class="locak_btn1" onclick="setLock(2,{{turn.id}},{{i+1}},0,this)" >瑣</span>
												{{else}}
<span class="locak_btn2" onclick="setLock(2,{{turn.id}},{{i+1}},1,this)" >解</span>
												{{/if}}
{{if turn.xzbg_lock[i]=='1'}}
<span class="locak_btn1" onclick="setLock(3,{{turn.id}},{{i+1}},0,this)" >瑣</span>
												{{else}}
<span class="locak_btn2" onclick="setLock(3,{{turn.id}},{{i+1}},1,this)" >解</span>
												{{/if}}

<div><span class="click_span" onclick="toSetConfig(1,{{turn.id}},{{i+1}},'{{turn.hbbg_config[i]}}',this)" >{{turn.hbbg_config[i]}}</span>
</div>
<div><span class="click_span" onclick="toSetConfig(2,{{turn.id}},{{i+1}},'{{turn.hbbg_config[i]}}',this)" >{{turn.xzbg_config[i]}}</span>
</div>



</td>
				{{/each}}
							    	<td>匯總報告</td>
									
							    	<!--td>匯總求和</td-->
									<!-- <td>原值報告</td> -->
							    	<td>合并報告</td>
									<!--td>合并求和</td-->
									<td>選擇報告</td>
							  	</tr>
							  	<tr class="data_col ">
							{{each turn.user_lock as val i}}
							    	<td>{{if bgData[i+1]}}
											<div class="bg-td">{{bgData[i+1][0].name}} <span {{if bgData[i+1][0].val>0}}class="red"{{/if}}>{{if bgData[i+1][0].name}}{{bgData[i+1][0].val}}{{/if}}</span></div>
										{{/if}}
									</td>
							{{/each}}
									<td> <div class="bg-td">{{bgData['hb'][0].name}}<span {{if bgData['hb'][0].val>0}}class="red"{{/if}}>{{if bgData['hb'][0].name}}{{bgData['hb'][0].val}}{{/if}}</span></div></td>
									<!--td> <div class="bg-td">{{bgData['qhBg'][0].name}}<span {{if bgData['qhBg'][0].val>0}}class="red"{{/if}}>{{if bgData['qhBg'][0].name}}{{bgData['qhBg'][0].val}}{{/if}}</span></div></td-->
							    	<!--td> <div class="bg-td">{{bgData['yzBg'][0].name}}<span {{if bgData['yzBg'][0].val>0}}class="red"{{/if}}>{{if bgData['yzBg'][0].name}}{{bgData['yzBg'][0].val}}{{/if}}</span></div></td-->
							  		<td> <div class="bg-td">{{bgData['hbBg'][0].name}}<span {{if bgData['hbBg'][0].val>0}}class="red"{{/if}}>{{if bgData['hbBg'][0].name}}{{bgData['hbBg'][0].val}}{{/if}}</span></div></td>
							    	<!--td> <div class="bg-td">{{bgData['hbqh'][0].name}}<span {{if bgData['hbqh'][0].val>0}}class="red"{{/if}}>{{if bgData['hbqh'][0].name}}{{bgData['hbqh'][0].val}}{{/if}}</span></div></td-->
							    	<td> <div class="bg-td">{{bgData['xzBg'][0].name}}<span {{if bgData['xzBg'][0].val>0}}class="red"{{/if}}>{{if bgData['xzBg'][0].name}}{{bgData['xzBg'][0].val}}{{/if}}</span></div></td>
							    	
								</tr>
							  <tr class="data_col">
							{{each turn.user_lock as val i}}
							    	<td>{{if bgData[i+1]}}
										<div class="bg-td">{{bgData[i+1][1].name}} <span {{if bgData[i+1][1].val>0}}class="red"{{/if}}>{{if bgData[i+1][1].name}}{{bgData[i+1][1].val}}{{/if}}</span></div>
									{{/if}}</td>
							{{/each}}
							    	
									<td><div class="bg-td">{{bgData['hb'][1].name}} <span {{if bgData['hb'][1].val>0}}class="red"{{/if}}>{{if bgData['hb'][1].name}}{{bgData['hb'][1].val}}{{/if}}</span></div></td>
									<!--td><div class="bg-td">{{bgData['qhBg'][1].name}} <span {{if bgData['qhBg'][1].val>0}}class="red"{{/if}}>{{if bgData['qhBg'][1].name}}{{bgData['qhBg'][1].val}}{{/if}}</span></div></td-->
							    	<!-- td><div class="bg-td">{{bgData['yzBg'][1].name}} <span {{if bgData['yzBg'][1].val>0}}class="red"{{/if}}>{{if bgData['yzBg'][1].name}}{{bgData['yzBg'][1].val}}{{/if}}</span></div></td -->
							    	<td><div class="bg-td">{{bgData['hbBg'][1].name}} <span {{if bgData['hbBg'][1].val>0}}class="red"{{/if}}>{{if bgData['hbBg'][1].name}}{{bgData['hbBg'][1].val}}{{/if}}</span></div></td>
							    	<!--td><div class="bg-td">{{bgData['hbqh'][1].name}} <span {{if bgData['hbqh'][1].val>0}}class="red"{{/if}}>{{if bgData['hbqh'][1].name}}{{bgData['hbqh'][1].val}}{{/if}}</span></div></td-->
							    	<td><div class="bg-td">{{bgData['xzBg'][1].name}} <span {{if bgData['xzBg'][1].val>0}}class="red"{{/if}}>{{if bgData['xzBg'][1].name}}{{bgData['xzBg'][1].val}}{{/if}}</span></div></td>
							    	
							    	
							    	
							  	</tr>
							  	<tr class="data_col">
							  		<td>序號</td>
							{{each turn.user_lock as val i}}
									<td class="blue"><div class="bg-td">共 <span >{{if bgData[i+1]}}{{bgData[i+1][2]}}{{/if}}</span></div></td>
							{{/each}}
							    	
							    	<td class="blue"><div class="bg-td">共 <span >{{bgData['hb'][2]}}</span></div></td>
									<!--td class="blue"><div class="bg-td">共 <span >{{bgData['qhBg'][2]}}</span></div></td-->
									<!--td class="blue"><div class="bg-td">共 <span >{{bgData['yzBg'][2]}}</span></div></td-->
									<td class="blue"><div class="bg-td">共 <span >{{bgData['hbBg'][2]}}</span></div></td>
							    	<!--td class="blue"><div class="bg-td">共 <span >{{bgData['hbqh'][2]}}</span></div></td-->
							    	<td class="blue"><div class="bg-td">共 <span >{{bgData['xzBg'][2]}}</span></div></td>
							    	
									<td>序號</td>
							  	</tr>
	</script>
	<script type="text/html" id="jg_tmpl">
	{{each jgData['hb'].list  as val i}}
	<tr>
	<td>{{i+1}}</td>
		{{each turn.user_lock as val j}}
			{{if jgData[j+1]}}
				<td {{if jgData[j+1].list[i]>0}}class="red"{{/if}}>{{jgData[j+1].list[i]}}</td>
			{{else}}
				<td></td>
			{{/if}}
		{{/each}}
	
	<td {{if val>0}}class="red"{{/if}}>{{val}}</td>
	<!--td {{if jgData['qhBg'].list[i]>0}}class="red"{{/if}}>{{jgData['qhBg'].list[i]}}</td-->
	<!--td {{if jgData['yzBg'].list[i]>0}}class="red"{{/if}}>{{jgData['yzBg'].list[i]}}</td -->
	<td {{if jgData['hbBg'].list[i]>0}}class="red"{{/if}}>{{jgData['hbBg'].list[i]}}</td>
	<!--td {{if jgData['hbqh'].list[i]>0}}class="red"{{/if}}>{{jgData['hbqh'].list[i]}}</td-->
	<td {{if jgData['xzBg'].list[i]>0}}class="red"{{/if}}>{{jgData['xzBg'].list[i]}}</td>
	
<td>{{i+1}}</td>
	</tr>
	{{/each}}
	</script>
	<script type="text/html" id="bottom_tmpl">
							<tr>
							  		<td>結果</td>
									{{each turn.user_lock as val j}}
										{{if jgData[j+1]}}
							    		<td class="blue2{{if jgData[j+1].jg>0}} red{{/if}}">{{jgData[j+1].jg}}</td>{{else}}<td  class="blue2"></td>{{/if}}	
									{{/each}}
							    	
							    	<td class="blue2 {{if jgData['hb'].jg>0}}red{{/if}}">{{jgData['hb'].jg}}</td>
									<!--td class="blue2 {{if jgData['qhBg'].jg>0}}red{{/if}}">{{jgData['qhBg'].jg}}</td-->
									<!--td class="blue2 {{if jgData['yzBg'].jg>0}}red{{/if}}">{{jgData['yzBg'].jg}}</td -->
									<td class="blue2 {{if jgData['hbBg'].jg>0}}red{{/if}}">{{jgData['hbBg'].jg}}</td>
									<!--td class="blue2 {{if jgData['hbqh'].jg>0}}red{{/if}}">{{jgData['hbqh'].jg}}</td-->								
									<td class="blue2 {{if jgData['xzBg'].jg>0}}red{{/if}}">{{jgData['xzBg'].jg}}</td>
																		
<td>結果</td>
							  	</tr>
							  	<tr>
							  		<td>求和</td>
									{{each turn.user_lock as val j}}
										{{if jgData[j+1]}}<td {{if jgData[j+1].qh>0}}class="red"{{/if}}>{{jgData[j+1].qh}}</td>{{else}}<td></td>{{/if}}
							    	
									{{/each}}
							    	
							    	<td {{if jgData['hb'].qh>0}}class="red"{{/if}}>{{jgData['hb'].qh}}</td>
									<!--td {{if jgData['qhBg'].qh>0}}class="red"{{/if}}>{{jgData['qhBg'].qh}}</td-->
									<!--td {{if jgData['yzBg'].qh>0}}class="red"{{/if}}>{{jgData['yzBg'].qh}}</td-->
									<td {{if jgData['hbBg'].qh>0}}class="red"{{/if}}>{{jgData['hbBg'].qh}}</td>
									<!--td {{if jgData['hbqh'].qh>0}}class="red"{{/if}}>{{jgData['hbqh'].qh}}</td-->
									<td {{if jgData['xzBg'].qh>0}}class="red"{{/if}}>{{jgData['xzBg'].qh}}</td>
									
<td>求和</td>
							  	</tr>
							  	<tr style="height:40px;">
							  		<td>共計</td>
									{{each turn.user_lock as val j}}
										{{if bgData[j+1]}}<td class="blue">{{bgData[j+1][3]}}</td>{{else}}<td class="blue"></td>{{/if}}
							    	
									{{/each}}
							    	
							    	<td class="blue">{{bgData['hb'][3]}}</td>
									<!--td class="blue">{{bgData['qhBg'][3]}}</td-->
									<!--td class="blue">{{bgData['yzBg'][3]}}</td-->
									<td class="blue">{{bgData['hbBg'][3]}}</td>
									<!--td class="blue">{{bgData['hbqh'][3]}}</td-->
									<td class="blue">{{bgData['xzBg'][3]}}</td>
							    	
									
<td>共計</td>
							  	</tr>
	</script>
	</body>
</html>
