<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.park.api.dao.CrowDao">

  	<select id="getGroup" resultType="int" >
  	 select djt_use_table from djt_user where is_su=1 limit 1
  	</select>
  	
  	<insert id="copy2ruing"  >
  	 INSERT INTO game_runing (hid,uid, grp, sheng) 
SELECT ${hid}, ${uid},grp,sheng FROM data_base WHERE tabl_num=#{tbNo}
  	</insert>
  	
  	<insert id="save">
  	INSERT INTO game_runing (`hid`, `uid`, `row`, `sheng`) VALUES (#{hid}, #{mo.uid}, #{mo.row}, #{mo.sheng})
  	</insert>
 	
 	
  <update id="update" >
	  UPDATE game_runing SET 
	  	pei = #{ model.pei }
	  	,dui=#{model.dui}
		,gong = #{ model.gong }
		,gong_col = #{ model.gong_col }
 WHERE id=#{model.id}
	</update>
  
  	<delete id="delete"> delete from djt_g_game where uid=#{uid}</delete>
 
 
 <insert id="copyTemplate">
 INSERT INTO djt_g_game (uid, crow, sheng)  select #{uid},d_id,d_data from djt_data_base
 </insert>
 

  	 <select id="getGameNum" resultType="int" >
 		select count(0) from djt_g_game where uid=#{uid}
  	</select>
  	
  	
  
  	<select id="getInputRow" resultType="com.park.api.entity.Crow" >
	select * from game_runing where hid = #{hid} AND row =#{row} limit 1 
 	</select>
  	

	
	<!-- 2018-8-28新加入 -->
	
 	
 	<select id="getUpTgVal" resultType="string" >
	select tg_val from game_runing where hid = #{hid} AND pei is not null ORDER BY row desc limit 1 
 	</select>
 	
 	 <select id="getRow" resultType="com.park.api.entity.Crow" >
	select `id`,  `hid`,  `uid`,  `row`,  `sheng`,  `pei`,  `dui`, `gong`,  `gong_col` from game_runing where row = #{row} AND hid = #{hid} limit 1
 	</select>
	
	
	
	<select id="getRuningCount" resultType="int" >
  	 select count(0) from game_runing where is_finish=1 AND uid =#{uid}
  	</select>
	
	
	<select id="getAllGong" resultType="map" >
  	 select row,gong,gong_col,tg_val from game_runing where  (gong is not null OR pei is not null)
		AND hid =#{hid} ORDER BY row
  	</select>
  	

  	
  	
 <insert id="createGame" useGeneratedKeys="true" keyProperty="mo.id">
 INSERT INTO game_history (uid,`tbNum`,focus_row, `info`, `createtime`) VALUES (#{mo.uid},#{mo.tbNum},#{mo.focus_row},#{mo.info} , #{mo.createtime});
 </insert>
  	
  	
 <select id="getRuningGame" resultType="com.park.api.entity.Game">
  	select * from game_history where uid=#{uid} AND state=1 ORDER BY createtime DESC limit 1
  	
 </select>
 
 
 	
  <update id="updateGame" >
	  UPDATE game_history 
	  <set>
	  <if test="mo.state!=null">state = #{ mo.state },</if>
	  <if test="mo.focus_row!=null">focus_row = #{ mo.focus_row },</if>
		</set>
 WHERE id=#{mo.id}
	</update>
 
  	
  	
 </mapper>
 